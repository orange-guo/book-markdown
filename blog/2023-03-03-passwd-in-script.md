---
authors: [ orange ]
tags: [linux]
---

# 脚本中实现修改用户密码

平时在写脚本的时候, 有时候会需要使用`passwd`命令来修改用户的密码.<br/>
例如为`NIS`的测试服务器新增一些测试用户, 并且为这些用户设置密码.<br/>
由于`passwd`需要交互式的输入, 所以在脚本中使用`passwd`命令会报错.<br/>
一个潜在的解决方案是加入`--stdin`参数但是有的`linux`发行版中`passwd`命令中的`--stdin`不存在.<br/>
如果你还这样执行的话将会显示以下错误.<br/>

```log
passwd: unrecognized option '--stdin'
Usage: passwd [options] [LOGIN]

Options:
  -a, --all                     report password status on all accounts
  -d, --delete                  delete the password for the named account
  -e, --expire                  force expire the password for the named account
  -h, --help                    display this help message and exit
  -k, --keep-tokens             change password only if expired
  -i, --inactive INACTIVE       set password inactive after expiration
                                to INACTIVE
  -l, --lock                    lock the password of the named account
  -n, --mindays MIN_DAYS        set minimum number of days before password
                                change to MIN_DAYS
  -q, --quiet                   quiet mode
  -r, --repository REPOSITORY   change password in REPOSITORY repository
  -R, --root CHROOT_DIR         directory to chroot into
  -S, --status                  report password status on the named account
  -u, --unlock                  unlock the password of the named account
  -w, --warndays WARN_DAYS      set expiration warning days to WARN_DAYS
  -x, --maxdays MAX_DAYS        set maximum number of days before password
                                change to MAX_DAYS
```

由于`passwd`命令中没有`--stdin`选项, 所以我们需要使用其他的方式来解决这个问题.<br/>

<!--truncate-->

## 解决方案

### 使用`chpasswd`

`chpasswd`命令可以用于批量修改用户的密码, 该命令的使用方法如下.

```bash
echo "user1:password1" | chpasswd
```

## 备注

不建议在脚本中修改密码, 因为这样会泄漏密码.<br/>
例如当脚本增加`set -x`选项时, 会将密码打印出来.<br/>
这种方式最好在测试环境中使用.<br/>

> Nothing you can do in bash can possibly work.
> passwd(1) does not read from standard input.
> This is intentional. It is for your protection.
> Passwords were never intended to be put into programs, or generated by programs.
> They were intended to be entered only by the fingers of an actual human being, with a functional brain, and never,
> ever written down anywhere.
> Nonetheless, we get hordes of users asking how they can circumvent 35 years of Unix security.

from

- [I want to set a user's password using the Unix passwd command, but how do I script that? It doesn't read standard input!](http://mywiki.wooledge.org/BashFAQ/078)

## 参考

- [Using the passwd Command from Within a Shell Script](https://www.baeldung.com/linux/passwd-shell-script#1-using-stdin-option)
- [Alternative to passwd --stdin in Ubuntu](https://askubuntu.com/questions/1115795/alternative-to-passwd-stdin-in-ubuntu)
- [Using the passwd command from within a shell script](https://stackoverflow.com/questions/714915/using-the-passwd-command-from-within-a-shell-script)
- [I want to set a user's password using the Unix passwd command, but how do I script that? It doesn't read standard input!](http://mywiki.wooledge.org/BashFAQ/078)