"use strict";(self.webpackChunkmarkdowns=self.webpackChunkmarkdowns||[]).push([[6297],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=p(n),c=r,g=m["".concat(s,".").concat(c)]||m[c]||u[c]||i;return n?a.createElement(g,l(l({ref:t},d),{},{components:n})):a.createElement(g,l({ref:t},d))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1805:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={},l="fastone-auditing\u670d\u52a1\u5347\u7ea7springboot3\u4e2d\u6784\u5efanative-image\u9047\u5230\u7684\u95ee\u9898",o={unversionedId:"problem/spring/0008",id:"problem/spring/0008",title:"fastone-auditing\u670d\u52a1\u5347\u7ea7springboot3\u4e2d\u6784\u5efanative-image\u9047\u5230\u7684\u95ee\u9898",description:"javax\u5347\u7ea7\u5230jakarta",source:"@site/docs/problem/spring/0008.md",sourceDirName:"problem/spring",slug:"/problem/spring/0008",permalink:"/markdowns/docs/problem/spring/0008",draft:!1,editUrl:"https://github.com/orange-guo/markdowns/tree/master/docs/problem/spring/0008.md",tags:[],version:"current",lastUpdatedBy:"xiangcheng.kuo",lastUpdatedAt:1676784673,formattedLastUpdatedAt:"Feb 19, 2023",frontMatter:{},sidebar:"problem",previous:{title:"mgmt-api\u7684Duration\u89e3\u6790\u6ca1\u6709\u548c\u9884\u671f\u5339\u914d",permalink:"/markdowns/docs/problem/spring/0007"},next:{title:"\u57fa\u4e8espring-aot\u7f16\u8bd1\u7684auditing\u670d\u52a1\u96c6\u6210fastone-nott-spring-boot-starter\u51fa\u73b0\u7684\u95ee\u9898",permalink:"/markdowns/docs/problem/spring/0009"}},s={},p=[{value:"javax\u5347\u7ea7\u5230jakarta",id:"javax\u5347\u7ea7\u5230jakarta",level:2},{value:"spring-Aot",id:"spring-aot",level:2},{value:"graalvm\u7248\u672c\u8fc7\u4e8e\u8001, \u9700\u8981\u66f4\u65b0\u523022.3",id:"graalvm\u7248\u672c\u8fc7\u4e8e\u8001-\u9700\u8981\u66f4\u65b0\u5230223",level:2},{value:"paketo\u4e0b\u8f7d\u4f9d\u8d56\u5931\u8d25",id:"paketo\u4e0b\u8f7d\u4f9d\u8d56\u5931\u8d25",level:2},{value:"\u65e5\u5fd7",id:"\u65e5\u5fd7",level:2},{value:"\u95ee\u9898\u539f\u56e0",id:"\u95ee\u9898\u539f\u56e0",level:2},{value:"binding-tool",id:"binding-tool",level:2},{value:"binding-tool\u4f7f\u7528\u65b9\u5f0f",id:"binding-tool\u4f7f\u7528\u65b9\u5f0f",level:2},{value:"\u5907\u6ce8",id:"\u5907\u6ce8",level:2},{value:"gradle\u5e38\u7528\u547d\u4ee4",id:"gradle\u5e38\u7528\u547d\u4ee4",level:2},{value:"<em>BootBuildImage</em>",id:"bootbuildimage",level:2}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"fastone-auditing\u670d\u52a1\u5347\u7ea7springboot3\u4e2d\u6784\u5efanative-image\u9047\u5230\u7684\u95ee\u9898"},"fastone-auditing\u670d\u52a1\u5347\u7ea7springboot3\u4e2d\u6784\u5efanative-image\u9047\u5230\u7684\u95ee\u9898"),(0,r.kt)("h2",{id:"javax\u5347\u7ea7\u5230jakarta"},"javax\u5347\u7ea7\u5230jakarta"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"querydsl\u4f9d\u8d56\u53d8\u66f4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'// https://github.com/querydsl/querydsl/issues/3296\nimplementation("com.querydsl:querydsl-jpa:5.0.0:jakarta")\nkapt("com.querydsl:querydsl-apt:5.0.0:jakarta")\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u4e2d",(0,r.kt)("inlineCode",{parentName:"li"},"javax.persistence"),"\u5207\u6362\u5230",(0,r.kt)("inlineCode",{parentName:"li"},"jakarta.persistence"))),(0,r.kt)("h2",{id:"spring-aot"},"spring-Aot"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"spring-native\u5df2\u88abspringboot3\u5185\u7f6e\u7684Aot\u53d6\u4ee3, \u6240\u4ee5\u4e0d\u9700\u8981\u5f15\u5165\u8001\u7684spring-native\u4f9d\u8d56"),(0,r.kt)("li",{parentName:"ul"},"\u901a\u8fc7",(0,r.kt)("inlineCode",{parentName:"li"},"ReflectiveProcessor"),"\u548c",(0,r.kt)("inlineCode",{parentName:"li"},"RuntimeHintsRegistrar"),"\u7528\u6765\u5e2e\u52a9\u751f\u6210\u53cd\u5c04\u63d0\u793a"),(0,r.kt)("li",{parentName:"ul"},"\u7531\u4e8equerydsl\u751f\u6210\u7684Q\u7c7b\u4e0d\u80fd\u653e\u5728",(0,r.kt)("inlineCode",{parentName:"li"},"@RegisterReflectionForBinding"),"\u4e0a(\u56e0\u4e3a\u7f16\u8bd1\u4f18\u5148\u7ea7\u539f\u56e0),\n\u5219\u9700\u8981\u91cd\u65b0\u5b9e\u73b0@RegisterReflectionForBinding\u7684\u5177\u4f53\u5b9e\u73b0\u903b\u8f91")),(0,r.kt)("h2",{id:"graalvm\u7248\u672c\u8fc7\u4e8e\u8001-\u9700\u8981\u66f4\u65b0\u5230223"},"graalvm\u7248\u672c\u8fc7\u4e8e\u8001, \u9700\u8981\u66f4\u65b0\u523022.3"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"GraalVM version 22.3 is required but 22.0 has been detected, please upgrade.\n")),(0,r.kt)("h2",{id:"paketo\u4e0b\u8f7d\u4f9d\u8d56\u5931\u8d25"},"paketo\u4e0b\u8f7d\u4f9d\u8d56\u5931\u8d25"),(0,r.kt)("h2",{id:"\u65e5\u5fd7"},"\u65e5\u5fd7"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"// unable to copy from https://github.com/bell-sw/Liberica/releases/download/17.0.5+8/bellsoft-jre17.0.5+8-linux-amd64.tar.gz to /tmp/ee56d911dd187d4965fe2d5280e17b76253eb40eb4e5c8582a17cd46ea0168b1/bellsoft-jre17.0.5+8-linux-amd64.tar.gz\n// [creator]     stream error: stream ID 1; PROTOCOL_ERROR; received from peer\n")),(0,r.kt)("h2",{id:"\u95ee\u9898\u539f\u56e0"},"\u95ee\u9898\u539f\u56e0"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/paketo-buildpacks/bellsoft-liberica/issues/7"},"https://github.com/paketo-buildpacks/bellsoft-liberica/issues/7")),(0,r.kt)("h2",{id:"binding-tool"},"binding-tool"),(0,r.kt)("p",null,"\u4f7f\u7528",(0,r.kt)("a",{parentName:"p",href:"https://github.com/dmikusa/binding-tool"},"binding-tool"),"\u5de5\u5177\u751f\u6210dependency-mapping\u5230bindings\u5e76\u6620\u5c04\u5230builder\u5bb9\u5668\u4e2d"),(0,r.kt)("h2",{id:"binding-tool\u4f7f\u7528\u65b9\u5f0f"},"binding-tool\u4f7f\u7528\u65b9\u5f0f"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./bt dm -t buildpack.toml\n./bt dm -b paketo-buildpacks/bellsoft-liberica\n./bt dm -b paketo-buildpacks/syft\n// https://raw.githubusercontent.com/paketo-buildpacks/bellsoft-liberica/main/buildpack.toml\n")),(0,r.kt)("h2",{id:"\u5907\u6ce8"},"\u5907\u6ce8"),(0,r.kt)("h2",{id:"gradle\u5e38\u7528\u547d\u4ee4"},"gradle\u5e38\u7528\u547d\u4ee4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./gradlew nativeCompile\n./gradlew bootBuildImage\n./build/native/nativeCompile/fastone-auditing\n")),(0,r.kt)("h2",{id:"bootbuildimage"},(0,r.kt)("em",{parentName:"h2"},"BootBuildImage")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Example")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'tasks.withType<BootBuildImage> {\n    // https://docs.spring.io/spring-boot/docs/3.0.0/gradle-plugin/reference/htmlsingle/#build-image.examples.caches\n    buildCache {\n        volume {\n            name.set("cache-${rootProject.name}.build")\n        }\n    }\n    launchCache {\n        volume {\n            name.set("cache-${rootProject.name}.launch")\n        }\n    }\n    publish.set(true)\n    docker {\n        publishRegistry {\n            username.set(System.getenv("HARBOR_USERNAME"))\n            password.set(System.getenv("HARBOR_PASSWORD"))\n        }\n    }\n\n    val labels = System.getenv("LABELS")?.replace(",", " ")\n\n    // https://github.com/paketo-buildpacks/image-labels\n    mapOf("SERVICE_BINDING_ROOT" to "/bindings").plus(\n        when (labels) {\n            null -> emptyMap()\n            else -> mapOf("BP_IMAGE_LABELS" to labels)\n        }\n    ).let { environment.set(it) }\n    bindings.set(listOf("${project.projectDir}/bindings:/bindings"))\n    val formatter = DateTimeFormatter.ofPattern("yyyyMMdd-HHmmss")\nimageName.set("hub.fastonetech.com/infra/${project.name}:${formatter.format(ZonedDateTime.now(ZoneId.of("UTC")))}")\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reference",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.developing-your-first-application.native-build-tools.gradle"},"https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.developing-your-first-application.native-build-tools.gradle")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples"},"https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples"))))))}m.isMDXComponent=!0}}]);