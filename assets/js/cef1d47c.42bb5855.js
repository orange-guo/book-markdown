"use strict";(self.webpackChunkmarkdowns=self.webpackChunkmarkdowns||[]).push([[5061],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>g});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},v=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(r),v=a,g=p["".concat(s,".").concat(v)]||p[v]||d[v]||i;return r?n.createElement(g,o(o({ref:t},u),{},{components:r})):n.createElement(g,o({ref:t},u))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=v;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=r[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}v.displayName="MDXCreateElement"},8869:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=r(7462),a=(r(7294),r(3905));const i={},o="Camunda",l={unversionedId:"problem/camunda",id:"problem/camunda",title:"Camunda",description:"JavaDelegate\u91cc\u8c03\u7528Service\u7684\u65b9\u6cd5\u5e76\u4e14Service\u65b9\u6cd5\u4e0a\u6709@Transactional\u6ce8\u89e3\u4f46DB\u4fee\u6539\u672a\u751f\u6548",source:"@site/docs/problem/camunda.md",sourceDirName:"problem",slug:"/problem/camunda",permalink:"/markdowns/docs/problem/camunda",draft:!1,editUrl:"https://github.com/orange-guo/markdowns/tree/master/docs/problem/camunda.md",tags:[],version:"current",lastUpdatedBy:"xiangcheng.kuo",lastUpdatedAt:1676365101,formattedLastUpdatedAt:"Feb 14, 2023",frontMatter:{},sidebar:"problem",previous:{title:"\u5e38\u7528\u547d\u4ee4",permalink:"/markdowns/docs/problem/command"},next:{title:"Cloud",permalink:"/markdowns/docs/problem/cloud"}},s={},c=[{value:"JavaDelegate\u91cc\u8c03\u7528Service\u7684\u65b9\u6cd5\u5e76\u4e14Service\u65b9\u6cd5\u4e0a\u6709@Transactional\u6ce8\u89e3\u4f46DB\u4fee\u6539\u672a\u751f\u6548",id:"javadelegate\u91cc\u8c03\u7528service\u7684\u65b9\u6cd5\u5e76\u4e14service\u65b9\u6cd5\u4e0a\u6709transactional\u6ce8\u89e3\u4f46db\u4fee\u6539\u672a\u751f\u6548",level:2},{value:"\u539f\u56e0",id:"\u539f\u56e0",level:3},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",level:3},{value:"service task \u6267\u884c\u8fc7\u957f\u5bfc\u81f4\u88ab\u91cd\u8bd5, \u4e0d\u7b26\u5408\u9884\u671f",id:"service-task-\u6267\u884c\u8fc7\u957f\u5bfc\u81f4\u88ab\u91cd\u8bd5-\u4e0d\u7b26\u5408\u9884\u671f",level:2},{value:"\u5982\u679ctask\u6709assignee\u5e76\u4e14\u4e5f\u6709candidateGroup\u7684\u8bdd\u901a\u8fc7candidateGroupIn\u67e5\u8be2\u5c06\u67e5\u4e0d\u5230\u8be5task",id:"\u5982\u679ctask\u6709assignee\u5e76\u4e14\u4e5f\u6709candidategroup\u7684\u8bdd\u901a\u8fc7candidategroupin\u67e5\u8be2\u5c06\u67e5\u4e0d\u5230\u8be5task",level:2},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848-1",level:3},{value:"\u6d4b\u8bd5\u4ee3\u7801\u65e0\u6cd5\u88ab\u6267\u884c",id:"\u6d4b\u8bd5\u4ee3\u7801\u65e0\u6cd5\u88ab\u6267\u884c",level:2},{value:"Should point to a running camunda engine rest api",id:"should-point-to-a-running-camunda-engine-rest-api",level:2}],u={toc:c};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"camunda"},"Camunda"),(0,a.kt)("h2",{id:"javadelegate\u91cc\u8c03\u7528service\u7684\u65b9\u6cd5\u5e76\u4e14service\u65b9\u6cd5\u4e0a\u6709transactional\u6ce8\u89e3\u4f46db\u4fee\u6539\u672a\u751f\u6548"},"JavaDelegate\u91cc\u8c03\u7528Service\u7684\u65b9\u6cd5\u5e76\u4e14Service\u65b9\u6cd5\u4e0a\u6709@Transactional\u6ce8\u89e3\u4f46DB\u4fee\u6539\u672a\u751f\u6548"),(0,a.kt)("h3",{id:"\u539f\u56e0"},"\u539f\u56e0"),(0,a.kt)("p",null,"Camunda\u8c03\u7528Delegate\u65f6\u4f1a\u5f00\u542f\u4e8b\u52a1(\u4e3a\u4e86\u4fdd\u8bc1\u5931\u8d25\u65f6\u53ef\u4ee5\u56de\u6eda\u6570\u636e), Spring\u7684@Transaction propagation = Propagation.REQUIRED ,\n\u7136\u540e\u5c31\u7528\u4e86Camunda\u7684\u90a3\u4e2a\u4e8b\u52a1\uff0c\nCamunda\u7684\u4e8b\u52a1\u4e2d\u4fee\u6539\u662f\u5bf9DB\u4e0d\u751f\u6548\u7684\u6240\u4ee5\u4f60\u770b\u4e0d\u5230\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u4fee\u6539\u7684\u6570\u636e\u63d0\u4ea4\u7684\u7ed3\u679c"),(0,a.kt)("h3",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'\n@Component\nclass StartClusterDelegate(\n    private val clusterOperator: ClusterOperator\n) : JavaDelegate, LogCapability {\n\n    override fun execute(execution: DelegateExecution) {\n        clusterOperator.start(execution.getVariableAs(VARNAME_CLUSTER_ID))\n    }\n}\n\n@Component\nclass ClusterOperator(\n    private val clusterService: ClusterService,\n    private val csClusterOperator: CsClusterOperator,\n    private val csStorageOperator: CsStorageOperator,\n    private val clusterBastionUserOperator: ClusterBastionUserOperator,\n    private val netEnvOperator: NetEnvOperator\n) : LongTimeOperationCapability {\n\n    override fun start(id: Long) {\n        clusterService.get(id).orNull()!!.let { cluster ->\n            clusterService.patch(id) {\n                state = ClusterState.STARTING\n            }\n            logger.info("Begin start cluster $id")\n            csStorageOperator.start(cluster.csStorageId)\n            csClusterOperator.start(cluster.csClusterId!!)\n            clusterBastionUserOperator.start(cluster.id)\n            logger.info("Successful to start cluster $id")\n            clusterService.patch(id) {\n                state = ClusterState.RUNNING\n            }\n        }\n\n    }\n\n}\n\n@Service\nclass ClusterService(\n    private val engine: ProcessEngine,\n    private val clusterRepo: ClusterRepository,\n    private val client: DeployService\n) : LogCapability {\n\n    @Transactional(propagation = Propagation.REQUIRES_NEW)\n    fun patch(id: Long, patchFun: PatchClusterDto.() -> Unit): Either<ClusterOperationError, ClusterDetail> =\n        clusterRepo.findById(id).map { originCluster ->\n            val patch = PatchClusterDto(patchFun).apply {\n                logger.info("patch request {}", this)\n            }\n            val patchedCluster = originCluster.copy(\n                cloudAccount = patch.cloudAccount ?: originCluster.cloudAccount,\n                csNetEnvId = patch.csNetEnvId ?: originCluster.csNetEnvId,\n                csStorageId = patch.csStoreId ?: originCluster.csStorageId,\n                csClusterId = patch.csClusterId ?: originCluster.csClusterId,\n                isDelivered = when (patch.deliveryCluster) {\n                    DeliveryCluster.YES -> true\n                    DeliveryCluster.NO -> false\n                    DeliveryCluster.NONE -> originCluster.isDelivered\n                },\n                state = patch.state ?: originCluster.state\n            )\n            patchedCluster.apply {\n                logger.info("patched cluster {}", this)\n            }\n        }.map {\n            clusterRepo.save(it)\n            get(it.id)\n        }.orElseGet {\n            Either.left(ClusterOperationError.NoSuchCluster(id))\n        }\n}\n\n')),(0,a.kt)("h2",{id:"service-task-\u6267\u884c\u8fc7\u957f\u5bfc\u81f4\u88ab\u91cd\u8bd5-\u4e0d\u7b26\u5408\u9884\u671f"},"service task \u6267\u884c\u8fc7\u957f\u5bfc\u81f4\u88ab\u91cd\u8bd5, \u4e0d\u7b26\u5408\u9884\u671f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"camunda:\n  bpm:\n    job-execution:\n      lock-time-in-millis: 999999999\n")),(0,a.kt)("h2",{id:"\u5982\u679ctask\u6709assignee\u5e76\u4e14\u4e5f\u6709candidategroup\u7684\u8bdd\u901a\u8fc7candidategroupin\u67e5\u8be2\u5c06\u67e5\u4e0d\u5230\u8be5task"},"\u5982\u679ctask\u6709assignee\u5e76\u4e14\u4e5f\u6709candidateGroup\u7684\u8bdd\u901a\u8fc7candidateGroupIn\u67e5\u8be2\u5c06\u67e5\u4e0d\u5230\u8be5task"),(0,a.kt)("h3",{id:"\u89e3\u51b3\u65b9\u6848-1"},"\u89e3\u51b3\u65b9\u6848"),(0,a.kt)("p",null,"TaskQuery.taskCandidateGroupIn()\nPer default it only selects tasks which are not already assigned to a user.\nTo also include assigned task in the result specify {@link #includeAssignedTasks()} in your query."),(0,a.kt)("h2",{id:"\u6d4b\u8bd5\u4ee3\u7801\u65e0\u6cd5\u88ab\u6267\u884c"},"\u6d4b\u8bd5\u4ee3\u7801\u65e0\u6cd5\u88ab\u6267\u884c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'"--glue", "gradle.cucumber"\n')),(0,a.kt)("p",null,"\u5728gradle task\u91cc javaexec\u4f20\u5165\u7684args\u65f6\u53bb\u9664\u8be5\u53c2\u6570\n",(0,a.kt)("inlineCode",{parentName:"p"},'"--glue", "gradle.cucumber"')),(0,a.kt)("h2",{id:"should-point-to-a-running-camunda-engine-rest-api"},"Should point to a running camunda engine rest api"),(0,a.kt)("p",null,"\u6dfb\u52a0rest\u4f9d\u8d56"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'implementation("org.camunda.bpm.springboot:camunda-bpm-spring-boot-starter-rest:7.14.0")\n')))}p.isMDXComponent=!0}}]);