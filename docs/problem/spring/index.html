<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-problem/spring">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Spring | markdowns</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://orange-guo.github.io/markdowns/docs/problem/spring"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring | markdowns"><meta data-rh="true" name="description" content="BaenUtils会把为null的属性也复制过去"><meta data-rh="true" property="og:description" content="BaenUtils会把为null的属性也复制过去"><link data-rh="true" rel="icon" href="/markdowns/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://orange-guo.github.io/markdowns/docs/problem/spring"><link data-rh="true" rel="alternate" href="https://orange-guo.github.io/markdowns/docs/problem/spring" hreflang="en"><link data-rh="true" rel="alternate" href="https://orange-guo.github.io/markdowns/docs/problem/spring" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/markdowns/blog/rss.xml" title="markdowns RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/markdowns/blog/atom.xml" title="markdowns Atom Feed"><link rel="stylesheet" href="/markdowns/assets/css/styles.de1670ec.css">
<link rel="preload" href="/markdowns/assets/js/runtime~main.9fc285d7.js" as="script">
<link rel="preload" href="/markdowns/assets/js/main.1d89c388.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/markdowns/"><div class="navbar__logo"><img src="/markdowns/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/markdowns/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">markdowns</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/markdowns/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/orange-guo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/markdowns/docs/introduction">简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/markdowns/docs/category/读书笔记">读书笔记</a><button aria-label="Toggle the collapsible sidebar category &#x27;读书笔记&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/markdowns/docs/category/收藏">收藏</a><button aria-label="Toggle the collapsible sidebar category &#x27;收藏&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/markdowns/docs/category/常见问题">常见问题</a><button aria-label="Toggle the collapsible sidebar category &#x27;常见问题&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/template">模板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/prod">生产遇到的问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/dev">开发遇到的问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/command">常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/camunda">Camunda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/cloud">Cloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/docker">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/gitlab">Gitlab</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/image-builder">Image-Builder</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/java">Java</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/kotlin">Kotlin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/ldap">LDAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/library">Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/linux">Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/maven">Maven</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/nginx">Nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/postgres">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/protobuf">Protobuf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/python">Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/smic">SMIC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/markdowns/docs/problem/spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/markdowns/docs/problem/test">测试</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/markdowns/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/markdowns/docs/category/常见问题"><span itemprop="name">常见问题</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Spring</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="baenutils会把为null的属性也复制过去">BaenUtils会把为null的属性也复制过去<a class="hash-link" href="#baenutils会把为null的属性也复制过去" title="Direct link to heading">​</a></h2><p>BeanUtils.copyProperties()并不会跳过null属性
而DomainBeanUtils会跳过</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NodeImage origin = new NodeImage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        origin.setName(&quot;origin&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        origin.setState(NodeImageState.AVAILABLE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NodeImage patch = new NodeImage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // BeanUtils.copyProperties(patch, origin);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DomainBeanUtils.copyProperties(patch, origin);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertThat(origin.getState()).isEqualTo(NodeImageState.AVAILABLE);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在使用BeanUtils情况下会报错</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-data-jpa空字符串在db里是否为null"><code>spring-data-jpa</code>空字符串在DB里是否为null?<a class="hash-link" href="#spring-data-jpa空字符串在db里是否为null" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-data-jpa删除entity时不生效"><code>spring-data-jpa</code>删除Entity时不生效<a class="hash-link" href="#spring-data-jpa删除entity时不生效" title="Direct link to heading">​</a></h2><p>因为加了一个@SQLDelete导致的</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Where(clause = &quot;deleted is null or deleted != true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SQLDelete(sql = &quot;update remote_desktop set deleted = true where id = ?&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class NodeImage extends BaseDomain {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>@SQLDelete(sql = &quot;update remote_desktop set deleted = true where id = ?&quot;)
这里的remote_desktop应改为node_image</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spring-data-jpa在testcase里deleteall不生效但是deleteallinbatch可以"><code>spring-data-jpa</code>在TestCase里deleteAll不生效，但是deleteAllInBatch可以<a class="hash-link" href="#spring-data-jpa在testcase里deleteall不生效但是deleteallinbatch可以" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@BeforeEach</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Transactional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void before() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        when(securityContextService.currentIsSuperUser()).thenReturn(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Authentication authentication = helper.getAuthentication(&quot;admin&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nodeImageRepository.deleteAllInBatch();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="securitycontext里的authentication是上一次登录帐号的">SecurityContext里的authentication是上一次登录帐号的<a class="hash-link" href="#securitycontext里的authentication是上一次登录帐号的" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="原因">原因<a class="hash-link" href="#原因" title="Direct link to heading">​</a></h3><p>SessionManagement默认打开会导致Session存放上一次认证的SecuriyContext,
若本次颁发的token未插入到SecurityContext则会导致脏数据产生</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案">解决方案<a class="hash-link" href="#解决方案" title="Direct link to heading">​</a></h3><p>应实现SecurityContextRepository而不是自定义Filter</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="springboottest记得标注transactional用于数据回滚防止脏数据污染环境">@SpringBootTest记得标注@Transactional用于数据回滚防止脏数据污染环境<a class="hash-link" href="#springboottest记得标注transactional用于数据回滚防止脏数据污染环境" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="flyway不工作">flyway不工作<a class="hash-link" href="#flyway不工作" title="Direct link to heading">​</a></h2><p>compileOnly(&quot;org.flywaydb:flyway-core:7.7.3&quot;) -&gt; implementation(&quot;org.flywaydb:flyway-core:7.7.3&quot;)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feignclient中pageable被当作body传输">FeignClient中Pageable被当作body传输<a class="hash-link" href="#feignclient中pageable被当作body传输" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="现象">现象<a class="hash-link" href="#现象" title="Direct link to heading">​</a></h3><p>调用FeignClient进行GET且分页请求时发现Pageable被生成为BODY</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="原因-1">原因<a class="hash-link" href="#原因-1" title="Direct link to heading">​</a></h3><p>自己定义的SpringEncoder有问题, 没有用PageableSpringEncoder, 导致SpringEncoder认为其是RequestBody并将其生成为body</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-1">解决方案<a class="hash-link" href="#解决方案-1" title="Direct link to heading">​</a></h3><p>采用框架默认的Encoder</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备注">备注<a class="hash-link" href="#备注" title="Direct link to heading">​</a></h3><ul><li>若要支持文件上传, 加入@Headers注解来提醒框架这是文件上传操作</li><li>另外Spring将停止对Commons.file进行支持, 要及时迁移</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mgmt-api的duration解析没有和预期匹配">mgmt-api的Duration解析没有和预期匹配<a class="hash-link" href="#mgmt-api的duration解析没有和预期匹配" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="现象-1">现象<a class="hash-link" href="#现象-1" title="Direct link to heading">​</a></h3><p>ConfigurationProperties对象里配置的Duration对象单位为毫秒</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="原因-2">原因<a class="hash-link" href="#原因-2" title="Direct link to heading">​</a></h3><p>SpringBoot内部Duration单位是毫秒, 若不通过@DurationUnit提供的话</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-2">解决方案<a class="hash-link" href="#解决方案-2" title="Direct link to heading">​</a></h3><p>增加Duration单位, 强制制定单位确保行为符合期望</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备注-1">备注<a class="hash-link" href="#备注-1" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="调用栈">调用栈<a class="hash-link" href="#调用栈" title="Direct link to heading">​</a></h4><ul><li><code>BindConverter</code></li><li><code>List&lt;ConversionService&gt; delegates</code></li><li><code>List&lt;Converter&gt; converters</code></li><li><code>StringToDurationConverter (SpringBoot)</code></li><li><code>NumberToDurationConverter (SpringBoot) 此处会根据注解去判断单位</code></li><li><code>DurationStyle.SIMPLE.parse</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastone-auditing服务升级springboot3中构建native-image遇到的问题">fastone-auditing服务升级springboot3中构建native-image遇到的问题<a class="hash-link" href="#fastone-auditing服务升级springboot3中构建native-image遇到的问题" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="javax升级到jakarta">javax升级到jakarta<a class="hash-link" href="#javax升级到jakarta" title="Direct link to heading">​</a></h3><ul><li>querydsl依赖变更</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// https://github.com/querydsl/querydsl/issues/3296</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implementation(&quot;com.querydsl:querydsl-jpa:5.0.0:jakarta&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kapt(&quot;com.querydsl:querydsl-apt:5.0.0:jakarta&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>代码中<code>javax.persistence</code>切换到<code>jakarta.persistence</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spring-aot">spring-Aot<a class="hash-link" href="#spring-aot" title="Direct link to heading">​</a></h3><ul><li>spring-native已被springboot3内置的Aot取代, 所以不需要引入老的spring-native依赖</li><li>通过<code>ReflectiveProcessor</code>和<code>RuntimeHintsRegistrar</code>用来帮助生成反射提示</li><li>由于querydsl生成的Q类不能放在<code>@RegisterReflectionForBinding</code>上(因为编译优先级原因),
则需要重新实现@RegisterReflectionForBinding的具体实现逻辑</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graalvm版本过于老-需要更新到223">graalvm版本过于老, 需要更新到22.3<a class="hash-link" href="#graalvm版本过于老-需要更新到223" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GraalVM version 22.3 is required but 22.0 has been detected, please upgrade.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paketo下载依赖失败">paketo下载依赖失败<a class="hash-link" href="#paketo下载依赖失败" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日志">日志<a class="hash-link" href="#日志" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// unable to copy from https://github.com/bell-sw/Liberica/releases/download/17.0.5+8/bellsoft-jre17.0.5+8-linux-amd64.tar.gz to /tmp/ee56d911dd187d4965fe2d5280e17b76253eb40eb4e5c8582a17cd46ea0168b1/bellsoft-jre17.0.5+8-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">creator</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     stream error: stream ID </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> PROTOCOL_ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> received from peer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="问题原因">问题原因<a class="hash-link" href="#问题原因" title="Direct link to heading">​</a></h4><p><a href="https://github.com/paketo-buildpacks/bellsoft-liberica/issues/7" target="_blank" rel="noopener noreferrer">https://github.com/paketo-buildpacks/bellsoft-liberica/issues/7</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="binding-tool">binding-tool<a class="hash-link" href="#binding-tool" title="Direct link to heading">​</a></h4><p>使用<a href="https://github.com/dmikusa/binding-tool" target="_blank" rel="noopener noreferrer">binding-tool</a>工具生成dependency-mapping到bindings并映射到builder容器中</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="binding-tool使用方式">binding-tool使用方式<a class="hash-link" href="#binding-tool使用方式" title="Direct link to heading">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./bt dm -t buildpack.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bt dm -b paketo-buildpacks/bellsoft-liberica</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bt dm -b paketo-buildpacks/syft</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// https://raw.githubusercontent.com/paketo-buildpacks/bellsoft-liberica/main/buildpack.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备注-2">备注<a class="hash-link" href="#备注-2" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="gradle常用命令">gradle常用命令<a class="hash-link" href="#gradle常用命令" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew nativeCompile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./gradlew bootBuildImage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./build/native/nativeCompile/fastone-auditing</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="bootbuildimage"><em>BootBuildImage</em><a class="hash-link" href="#bootbuildimage" title="Direct link to heading">​</a></h4><ul><li>Example</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tasks.withType&lt;BootBuildImage&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // https://docs.spring.io/spring-boot/docs/3.0.0/gradle-plugin/reference/htmlsingle/#build-image.examples.caches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buildCache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volume {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name.set(&quot;cache-${rootProject.name}.build&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    launchCache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volume {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name.set(&quot;cache-${rootProject.name}.launch&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publish.set(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    docker {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publishRegistry {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            username.set(System.getenv(&quot;HARBOR_USERNAME&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            password.set(System.getenv(&quot;HARBOR_PASSWORD&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val labels = System.getenv(&quot;LABELS&quot;)?.replace(&quot;,&quot;, &quot; &quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // https://github.com/paketo-buildpacks/image-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapOf(&quot;SERVICE_BINDING_ROOT&quot; to &quot;/bindings&quot;).plus(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        when (labels) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            null -&gt; emptyMap()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else -&gt; mapOf(&quot;BP_IMAGE_LABELS&quot; to labels)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).let { environment.set(it) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bindings.set(listOf(&quot;${project.projectDir}/bindings:/bindings&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val formatter = DateTimeFormatter.ofPattern(&quot;yyyyMMdd-HHmmss&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imageName.set(&quot;hub.fastonetech.com/infra/${project.name}:${formatter.format(ZonedDateTime.now(ZoneId.of(&quot;UTC&quot;)))}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Reference<ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.developing-your-first-application.native-build-tools.gradle" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.developing-your-first-application.native-build-tools.gradle</a></li><li><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples" target="_blank" rel="noopener noreferrer">https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#build-image.examples</a></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基于spring-aot编译的auditing服务集成fastone-nott-spring-boot-starter出现的问题">基于spring-aot编译的auditing服务集成fastone-nott-spring-boot-starter出现的问题<a class="hash-link" href="#基于spring-aot编译的auditing服务集成fastone-nott-spring-boot-starter出现的问题" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configurationproperties标识的对象中嵌套的对象不标注nestedconfigurationproperty在运行期间调用会出现问题">@ConfigurationProperties标识的对象中嵌套的对象不标注@NestedConfigurationProperty在运行期间调用会出现问题<a class="hash-link" href="#configurationproperties标识的对象中嵌套的对象不标注nestedconfigurationproperty在运行期间调用会出现问题" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-3">解决方案<a class="hash-link" href="#解决方案-3" title="Direct link to heading">​</a></h4><p>对于<code>ConfigurationProperties</code>中嵌套的对象加入<code>@NestedConfigurationProperty</code>注解进行标识</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a class="hash-link" href="#参考" title="Direct link to heading">​</a></h4><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/native-image.html#native-image.advanced.nested-configuration-properties" target="_blank" rel="noopener noreferrer">Nested Configuration Properties</a></li></ul><blockquote><p>Reflection hints are automatically created for configuration properties by the Spring ahead-of-time engine.
Nested configuration properties which are not inner classes, however, must be annotated with
@NestedConfigurationProperty, otherwise they won’t be detected and will not be bindable.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行期间使用到classpath下的静态资源需要提前声明">运行期间使用到<code>ClassPath</code>下的静态资源需要提前声明<a class="hash-link" href="#运行期间使用到classpath下的静态资源需要提前声明" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-4">解决方案<a class="hash-link" href="#解决方案-4" title="Direct link to heading">​</a></h4><p>在<code>RuntimeHintsRegistrar</code>的<code>registerHints</code>方法中注册静态资源</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hints.resources().registerResource(ClassPathResource(&quot;ca.crt&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hints.resources().registerResource(ClassPathResource(&quot;client.crt&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hints.resources().registerResource(ClassPathResource(&quot;client.key&quot;))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conditionalonproperty不生效">@ConditionalOnProperty不生效<a class="hash-link" href="#conditionalonproperty不生效" title="Direct link to heading">​</a></h3><p>spring-boot-native not supported @ConditionalOnProperty yet</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-1">参考<a class="hash-link" href="#参考-1" title="Direct link to heading">​</a></h4><ul><li><a href="https://github.com/spring-projects-experimental/spring-native/issues/1613" target="_blank" rel="noopener noreferrer">Possibility of @ConditionalOnProperty support on spring-native</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api接口报错后没有返回异常信息">api接口报错后没有返回异常信息<a class="hash-link" href="#api接口报错后没有返回异常信息" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-5">解决方案<a class="hash-link" href="#解决方案-5" title="Direct link to heading">​</a></h4><p>application.yml中增加以下配置</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">error</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">include-message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-2">参考<a class="hash-link" href="#参考-2" title="Direct link to heading">​</a></h4><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#application-properties.server.server.error.include-message" target="_blank" rel="noopener noreferrer">server.error.include-message</a></li><li><a href="https://www.baeldung.com/exception-handling-for-rest-with-spring" target="_blank" rel="noopener noreferrer">Error Handling for REST with Spring</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastone-billing-sync服务升级springboot3中构建native-image遇到的问题">fastone-billing-sync服务升级springboot3中构建native-image遇到的问题<a class="hash-link" href="#fastone-billing-sync服务升级springboot3中构建native-image遇到的问题" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kotlinx-coroutines反射问题">kotlinx-coroutines反射问题<a class="hash-link" href="#kotlinx-coroutines反射问题" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日志-1">日志<a class="hash-link" href="#日志-1" title="Direct link to heading">​</a></h4><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java.lang.NoSuchMethodException: kotlin.internal.jdk8.JDK8PlatformImplementations.&lt;init&gt;()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-6">解决方案<a class="hash-link" href="#解决方案-6" title="Direct link to heading">​</a></h4><p>classpath下的<code>META-INF/native-image/reflect-config.json</code>文件增加如下内容用于配置反射提示</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.reflect.jvm.internal.ReflectionFactoryImpl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredConstructors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.KotlinVersion&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allPublicMethods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredFields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredMethods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredConstructors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.KotlinVersion[]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.KotlinVersion$Companion&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.KotlinVersion$Companion[]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kotlin.internal.jdk8.JDK8PlatformImplementations&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allPublicMethods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredFields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredMethods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;allDeclaredConstructors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-3">参考<a class="hash-link" href="#参考-3" title="Direct link to heading">​</a></h4><ul><li><a href="https://stackoverflow.com/questions/74612654/how-to-provide-runtimehints-for-internal-classes-in-springboot3" target="_blank" rel="noopener noreferrer">How to provide RuntimeHints for Internal Classes in SpringBoot3</a></li><li><a href="https://github.com/spring-projects-experimental/spring-native/issues/1646" target="_blank" rel="noopener noreferrer">Kotlin: Native reflection config missing kotlin.internal.jdk8.JDK8PlatformImplementations #1646</a></li><li><a href="https://youtrack.jetbrains.com/issue/KT-51579" target="_blank" rel="noopener noreferrer">PlatformImplementations loading is not compatible with graalvm native-image --no-fallback</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ktor反射问题">ktor反射问题<a class="hash-link" href="#ktor反射问题" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="日志-2">日志<a class="hash-link" href="#日志-2" title="Direct link to heading">​</a></h4><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: java.lang.RuntimeException: java.lang.NoSuchFieldException: top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.atomic.AtomicLongFieldUpdater$CASUpdater.&lt;init&gt;(AtomicLongFieldUpdater.java:205)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.atomic.AtomicLongFieldUpdater.newUpdater(AtomicLongFieldUpdater.java:95)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at io.ktor.utils.io.pool.DefaultPool.&lt;clinit&gt;(DefaultPool.kt:97)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.oracle.svm.core.hub.ClassInitializationInfo.invokeClassInitializer(ClassInitializationInfo.java:350)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at com.oracle.svm.core.hub.ClassInitializationInfo.initialize(ClassInitializationInfo.java:270)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 39 more</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: java.lang.NoSuchFieldException: top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Class.getDeclaredField(DynamicHub.java:2411)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.util.concurrent.atomic.AtomicLongFieldUpdater$CASUpdater.&lt;init&gt;(AtomicLongFieldUpdater.java:202)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ... 43 more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-7">解决方案<a class="hash-link" href="#解决方案-7" title="Direct link to heading">​</a></h4><p>classpath下的<code>META-INF/native-image/reflect-config.json</code>文件增加如下内容用于配置反射提示</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;io.ktor.utils.io.pool.DefaultPool&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fields&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;allowUnsafeAccess&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-4">参考<a class="hash-link" href="#参考-4" title="Direct link to heading">​</a></h4><ul><li><a href="https://github.com/rsocket/rsocket-kotlin/issues/77" target="_blank" rel="noopener noreferrer">GraalVM native-image support broken due to Payload #77</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ktor-client序列化对象的反射问题">ktor-client序列化对象的反射问题<a class="hash-link" href="#ktor-client序列化对象的反射问题" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-8">解决方案<a class="hash-link" href="#解决方案-8" title="Direct link to heading">​</a></h4><p>使用spring-aot增加反射提示, 代码如下</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class ReflectiveProcessorImpl : ReflectiveProcessor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun registerReflectionHints(hints: ReflectionHints, element: AnnotatedElement) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val function = BindingReflectionHintsRegistrar()::registerReflectionHints.partially1(hints)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        function(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arrayOf(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Page::class.java,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ResponseResult::class.java,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SignInRequest::class.java,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SignInResponse::class.java</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class RuntimeHintsImpl : RuntimeHintsRegistrar {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override fun registerHints(hints: RuntimeHints, classLoader: ClassLoader?) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Caused by: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `java.util.HashSet` (no Creators, like default constructor, exist): no default no-arguments constructor found</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // at [Source: (InputStreamReader); line: 1, column: 20] (through reference chain: com.fastonetech.lib.web.ResponseResult[&quot;data&quot;]-&gt;com.fastonetech.billing.sync.infra.client.Page[&quot;content&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hints.reflection().registerConstructor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ReflectionUtils.accessibleConstructor(java.util.HashSet::class.java),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ExecutableMode.INVOKE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Reflective(ReflectiveProcessorImpl::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ImportRuntimeHints(RuntimeHintsImpl::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BillingSyncApplication</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-5">参考<a class="hash-link" href="#参考-5" title="Direct link to heading">​</a></h4><ul><li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api//org/springframework/aot/hint/annotation/Reflective.html" target="_blank" rel="noopener noreferrer">Annotation Interface Reflective</a></li><li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api//org/springframework/context/annotation/ImportRuntimeHints.html" target="_blank" rel="noopener noreferrer">Annotation Interface ImportRuntimeHints</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建出的镜像不是native">构建出的镜像不是native<a class="hash-link" href="#构建出的镜像不是native" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="原始配置">原始配置<a class="hash-link" href="#原始配置" title="Direct link to heading">​</a></h4><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mapOf(&quot;SERVICE_BINDING_ROOT&quot; to &quot;/bindings&quot;).plus(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when (labels) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        null -&gt; emptyMap()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else -&gt; mapOf(&quot;BP_IMAGE_LABELS&quot; to labels)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">).let {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment.set(it) // ensure BP_NATIVE_IMAGE exists, and it&#x27;s value is true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-9">解决方案<a class="hash-link" href="#解决方案-9" title="Direct link to heading">​</a></h4><p>由于environment.set会覆盖原有的环境变量, 所以需要显式声明<code>BP_NATIVE_IMAGE</code></p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mapOf(&quot;SERVICE_BINDING_ROOT&quot; to &quot;/bindings&quot;, &quot;BP_NATIVE_IMAGE&quot; to &quot;true&quot;).plus(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when (labels) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        null -&gt; emptyMap()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else -&gt; mapOf(&quot;BP_IMAGE_LABELS&quot; to labels)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">).let {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment.set(it) // ensure BP_NATIVE_IMAGE exists, and it&#x27;s value is true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="备注-3">备注<a class="hash-link" href="#备注-3" title="Direct link to heading">​</a></h4><ul><li><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/" target="_blank" rel="noopener noreferrer">5.3. Image Customizations下的environment默认值介绍</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-scheduler集成fastone-security-spring-boot-starter后报错提示no-servletcontext-set">cluster-scheduler集成fastone-security-spring-boot-starter后报错提示No ServletContext set<a class="hash-link" href="#cluster-scheduler集成fastone-security-spring-boot-starter后报错提示no-servletcontext-set" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="现象-2">现象<a class="hash-link" href="#现象-2" title="Direct link to heading">​</a></h3><p>日志如下。</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error starting ApplicationContext. To display the condition evaluation report re-run your application with &#x27;debug&#x27; enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2023-01-30T15:02:32.838Z ERROR 1 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;resourceHandlerMapping&#x27; defined in class path resource [org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration$EnableWebMvcConfiguration.class]: Failed to instantiate [org.springframework.web.servlet.HandlerMapping]: Factory method &#x27;resourceHandlerMapping&#x27; threw exception with message: No ServletContext set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:645) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1324) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1161) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:561) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:521) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:961) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:915) ~[spring-context-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:584) ~[spring-context-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:730) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:432) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:308) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1302) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1291) ~[spring-boot-3.0.2.jar:3.0.2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at com.fastonetech.clusterscheduler.ClusterSchedulerApplication.main(ClusterSchedulerApplication.java:20) ~[classes/:na]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.web.servlet.HandlerMapping]: Factory method &#x27;resourceHandlerMapping&#x27; threw exception with message: No ServletContext set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:171) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ... 19 common frames omitted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Caused by: java.lang.IllegalStateException: No ServletContext set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.util.Assert.state(Assert.java:76) ~[spring-core-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport.resourceHandlerMapping(WebMvcConfigurationSupport.java:581) ~[spring-webmvc-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:139) ~[spring-beans-6.0.4.jar:6.0.4]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ... 20 common frames omitted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="原因-3">原因<a class="hash-link" href="#原因-3" title="Direct link to heading">​</a></h3><p>FastoneSecurityContextService类中的AuthService为构造注入导致该错误发生(具体错误原因未知),
为AuthService为属性增加@Autowired和@Lazy注解后, 该错误消失</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequiredArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FastoneSecurityContextService implements SecurityContextService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final FastoneUserDetailsService userDetailsService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AuthService authService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-10">解决方案<a class="hash-link" href="#解决方案-10" title="Direct link to heading">​</a></h3><p>修改FastoneSecurityContextService类, 为AuthService为属性增加@Autowired和@Lazy注解</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequiredArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FastoneSecurityContextService implements SecurityContextService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private FastoneUserDetailsService userDetailsService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final AuthService authService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者使用<code>java-config</code>方式</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UserConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FastoneSecurityContextService securityContextService(FastoneUserDetailsService userDetailsService, @Lazy AuthService authService) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new FastoneSecurityContextService(userDetailsService, authService);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备注-4">备注<a class="hash-link" href="#备注-4" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fastone-api升级spring-boot3后请求swagger-uiindexhtml报错">fastone-api升级spring-boot3后请求<code>/swagger-ui/index.html</code>报错<a class="hash-link" href="#fastone-api升级spring-boot3后请求swagger-uiindexhtml报错" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="现象-3">现象<a class="hash-link" href="#现象-3" title="Direct link to heading">​</a></h3><p>接口报错, 内容如下</p><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">chrome</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This page isn’t working</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If the problem continues, contact the site owner.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP ERROR 401</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="原因-4">原因<a class="hash-link" href="#原因-4" title="Direct link to heading">​</a></h3><p>springdoc版本过老, 需要升级到v2版本。<br>
<a href="https://springdoc.org/" target="_blank" rel="noopener noreferrer">springdoc.org</a>
上的有相关说明<code>For spring-boot v3 support, make sure you use springdoc-openapi v2</code></p><p>本项目的原始配置如下</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springdoc</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springdoc-openapi-ui</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1.6.14</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-11">解决方案<a class="hash-link" href="#解决方案-11" title="Direct link to heading">​</a></h3><p>升级springdoc版本到v2, 升级后的配置如下, v2的artifactId发生了变化</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">pom.xml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springdoc</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springdoc-openapi-starter-webmvc-ui</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2.0.2</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备注-5">备注<a class="hash-link" href="#备注-5" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="参考-6">参考<a class="hash-link" href="#参考-6" title="Direct link to heading">​</a></h4><ul><li><a href="https://springdoc.org/" target="_blank" rel="noopener noreferrer">springdoc.org</a></li><li><a href="https://springdoc.org/v2/" target="_blank" rel="noopener noreferrer">springdocv2</a></li><li><a href="https://stackoverflow.com/questions/74614369/how-to-run-swagger-3-on-spring-boot-3" target="_blank" rel="noopener noreferrer">How to run Swagger 3 on Spring Boot 3</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="代码调用流程">代码调用流程<a class="hash-link" href="#代码调用流程" title="Direct link to heading">​</a></h4><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">AuthorizationFilter.doFilter</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">this.authorizationManager.check(this::getAuthentication, request);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">ObservationAuthorizationManager.check</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AuthorizationDecision decision = this.delegate.check(wrapped, object);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">RequestMatcherDelegatingAuthorizationManager.check</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">matcher.matcher(request);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">MvcRequestMatcher.matcher</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 返回了`path`为`/error`的`handlerMapping`(说明没有找到对应的`handlerMapping`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatchableHandlerMapping mapping = getMapping(request);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">RequestMatcherDelegatingAuthorizationManager.check</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RequestMatcher matcher = mapping.getRequestMatcher();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MatchResult matchResult = matcher.matcher(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 由于swagger对应的handler找不到, 所以没有Match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (matchResult.isMatch()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthorizationManager&lt;RequestAuthorizationContext&gt; manager = mapping.getEntry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (this.logger.isTraceEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.logger.trace(LogMessage.format(&quot;Checking authorization on %s using %s&quot;, request, manager));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 后续命中了Mvc [pattern=&#x27;/*/*.html&#x27;]对应的Matcher, 而该Matcher对应的匹配规则要求需要`authentication`不为空, 导致报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return manager.check(authentication, new RequestAuthorizationContext(request, matchResult.getVariables()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/orange-guo/markdowns/tree/master/docs/problem/spring.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-01-31T04:33:12.000Z">Jan 31, 2023</time></b> by <b>xiangcheng.kuo</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/markdowns/docs/problem/smic"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SMIC</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/markdowns/docs/problem/test"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">测试</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#baenutils会把为null的属性也复制过去" class="table-of-contents__link toc-highlight">BaenUtils会把为null的属性也复制过去</a></li><li><a href="#spring-data-jpa空字符串在db里是否为null" class="table-of-contents__link toc-highlight"><code>spring-data-jpa</code>空字符串在DB里是否为null?</a></li><li><a href="#spring-data-jpa删除entity时不生效" class="table-of-contents__link toc-highlight"><code>spring-data-jpa</code>删除Entity时不生效</a></li><li><a href="#spring-data-jpa在testcase里deleteall不生效但是deleteallinbatch可以" class="table-of-contents__link toc-highlight"><code>spring-data-jpa</code>在TestCase里deleteAll不生效，但是deleteAllInBatch可以</a></li><li><a href="#securitycontext里的authentication是上一次登录帐号的" class="table-of-contents__link toc-highlight">SecurityContext里的authentication是上一次登录帐号的</a><ul><li><a href="#原因" class="table-of-contents__link toc-highlight">原因</a></li><li><a href="#解决方案" class="table-of-contents__link toc-highlight">解决方案</a></li></ul></li><li><a href="#springboottest记得标注transactional用于数据回滚防止脏数据污染环境" class="table-of-contents__link toc-highlight">@SpringBootTest记得标注@Transactional用于数据回滚防止脏数据污染环境</a></li><li><a href="#flyway不工作" class="table-of-contents__link toc-highlight">flyway不工作</a></li><li><a href="#feignclient中pageable被当作body传输" class="table-of-contents__link toc-highlight">FeignClient中Pageable被当作body传输</a><ul><li><a href="#现象" class="table-of-contents__link toc-highlight">现象</a></li><li><a href="#原因-1" class="table-of-contents__link toc-highlight">原因</a></li><li><a href="#解决方案-1" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#备注" class="table-of-contents__link toc-highlight">备注</a></li></ul></li><li><a href="#mgmt-api的duration解析没有和预期匹配" class="table-of-contents__link toc-highlight">mgmt-api的Duration解析没有和预期匹配</a><ul><li><a href="#现象-1" class="table-of-contents__link toc-highlight">现象</a></li><li><a href="#原因-2" class="table-of-contents__link toc-highlight">原因</a></li><li><a href="#解决方案-2" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#备注-1" class="table-of-contents__link toc-highlight">备注</a></li></ul></li><li><a href="#fastone-auditing服务升级springboot3中构建native-image遇到的问题" class="table-of-contents__link toc-highlight">fastone-auditing服务升级springboot3中构建native-image遇到的问题</a><ul><li><a href="#javax升级到jakarta" class="table-of-contents__link toc-highlight">javax升级到jakarta</a></li><li><a href="#spring-aot" class="table-of-contents__link toc-highlight">spring-Aot</a></li><li><a href="#graalvm版本过于老-需要更新到223" class="table-of-contents__link toc-highlight">graalvm版本过于老, 需要更新到22.3</a></li><li><a href="#paketo下载依赖失败" class="table-of-contents__link toc-highlight">paketo下载依赖失败</a></li><li><a href="#备注-2" class="table-of-contents__link toc-highlight">备注</a></li></ul></li><li><a href="#基于spring-aot编译的auditing服务集成fastone-nott-spring-boot-starter出现的问题" class="table-of-contents__link toc-highlight">基于spring-aot编译的auditing服务集成fastone-nott-spring-boot-starter出现的问题</a><ul><li><a href="#configurationproperties标识的对象中嵌套的对象不标注nestedconfigurationproperty在运行期间调用会出现问题" class="table-of-contents__link toc-highlight">@ConfigurationProperties标识的对象中嵌套的对象不标注@NestedConfigurationProperty在运行期间调用会出现问题</a></li><li><a href="#运行期间使用到classpath下的静态资源需要提前声明" class="table-of-contents__link toc-highlight">运行期间使用到<code>ClassPath</code>下的静态资源需要提前声明</a></li><li><a href="#conditionalonproperty不生效" class="table-of-contents__link toc-highlight">@ConditionalOnProperty不生效</a></li><li><a href="#api接口报错后没有返回异常信息" class="table-of-contents__link toc-highlight">api接口报错后没有返回异常信息</a></li></ul></li><li><a href="#fastone-billing-sync服务升级springboot3中构建native-image遇到的问题" class="table-of-contents__link toc-highlight">fastone-billing-sync服务升级springboot3中构建native-image遇到的问题</a><ul><li><a href="#kotlinx-coroutines反射问题" class="table-of-contents__link toc-highlight">kotlinx-coroutines反射问题</a></li><li><a href="#ktor反射问题" class="table-of-contents__link toc-highlight">ktor反射问题</a></li><li><a href="#ktor-client序列化对象的反射问题" class="table-of-contents__link toc-highlight">ktor-client序列化对象的反射问题</a></li><li><a href="#构建出的镜像不是native" class="table-of-contents__link toc-highlight">构建出的镜像不是native</a></li></ul></li><li><a href="#cluster-scheduler集成fastone-security-spring-boot-starter后报错提示no-servletcontext-set" class="table-of-contents__link toc-highlight">cluster-scheduler集成fastone-security-spring-boot-starter后报错提示No ServletContext set</a><ul><li><a href="#现象-2" class="table-of-contents__link toc-highlight">现象</a></li><li><a href="#原因-3" class="table-of-contents__link toc-highlight">原因</a></li><li><a href="#解决方案-10" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#备注-4" class="table-of-contents__link toc-highlight">备注</a></li></ul></li><li><a href="#fastone-api升级spring-boot3后请求swagger-uiindexhtml报错" class="table-of-contents__link toc-highlight">fastone-api升级spring-boot3后请求<code>/swagger-ui/index.html</code>报错</a><ul><li><a href="#现象-3" class="table-of-contents__link toc-highlight">现象</a></li><li><a href="#原因-4" class="table-of-contents__link toc-highlight">原因</a></li><li><a href="#解决方案-11" class="table-of-contents__link toc-highlight">解决方案</a></li><li><a href="#备注-5" class="table-of-contents__link toc-highlight">备注</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/markdowns/docs/introduction">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/markdowns/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/orange-guo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/markdowns/assets/js/runtime~main.9fc285d7.js"></script>
<script src="/markdowns/assets/js/main.1d89c388.js"></script>
</body>
</html>