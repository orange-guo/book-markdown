[toc]
# 前言
- `1994 GoF 《设计模式：可复用面向对象软件的基础》`
- `2002 Martin Fowler的《重构：改善既有代码的设计》`
- `设计模式代表了传统软件开发的思想, 好的设计会产生好的软件, 因此在实际开发之前值得话时间去做一个全面而细致的设计`
- `重构则代表了敏捷软件开发的浪潮：软件并不是在一开始就可以设计得完美无缺的，因此可以先进行实际开发，然后通过对代码不断地进行小幅度的修改来改善其设计`
- `设计模式和重构这两种方式看似格格不入，但是它们在本质上都有一个相同的思想——设计很重要，只是两者达到良好设计的方法不同。`
- `设计模式则是广大软件开发人员总结出的开发经验和技巧，它们利用编程语言的特性，实现这些设计准则。因此，在有经验的软件设计师眼里，没有设计模式，只有设计准则。`
- `重构是实现设计模式的一种手段，设计模式往往也是重构的目的。`

## 0. 前言
- 软件模式的伟大之处在于他们传达了许多有用的设计思想
- 不再预先(up-front)设计中使用模式, 不再过早地再代码中加入模式(XP)



## 1. 过度设计
#### 解释
> 为了适应为了的将来的需求, 代码的灵活性和复杂性超出目前所需.
但是人不可能未卜先知, 有的时候预计错误浪费的将是宝贵的时间和金钱.
过度设计总在不知不觉之中出现，许多架构师和程序员在进行过度设计时甚至自己都不曾意识到。



## 2. 模式万灵丹
> 有时遇到某个可以使用两三种不同方法进行的计算，可能会想到实现`Strategy`模式，而事实上，使用简单的条件表达式编程更加容易，也更加快捷，完全足够。
应该重新把精力放在短小、简单和直截了当的代码上。避免模式产生的过度设计, 放弃对模式的依赖



## 3. 设计不足
#### 原因
- 程序员没有时间，没有抽出时间，或者时间不允许进行重构
- 程序员在何为好的软件设计方面知识不足
- 程序员被要求在既有系统中快速地添加新功能
- 程序员被迫同时进行太多项目
#### 影响
- 随着时间的推移，设计不足的软件将变成昂贵、难以维护甚至无法维护的大麻烦
#### Big Ball of Mud（大泥球）
- 数据结构构造随意, 甚至近乎不存在
- 变量名和函数名信息量不足, 甚至起误导作用



## 4. 测试驱动开发&持续重构
#### 以对话形式进行测试驱动开发
> 问：编写一个测试，向系统提问
答：编写代码通过这个测试，回答这一提问
提炼：通过合并概念、去芜存菁、消除歧义，提炼你的回答
反复：提出下一个问题，继续进行对话
#### 红、绿、重构
>红：创建一个测试，表示代码所要完成的任务。在编写的代码能够通过测试之前，测试将失败（显示红色）。
绿：编写一些权宜代码，先通过测试（显示绿色）。这时，你用不着为难自己，非要给出没有重复、简单和清晰的设计。可以在测试通过、能够心安理得地尝试更好的设计之后，再逐步朝这个目标努力。
重构：对已经通过测试的代码，改进其设计。
#### 测试驱动开发总结
>测试驱动开发和持续重构提供了一种精益、迭代和训练有素的编程风格，能够最大程度地有张有弛，提高生产率。Martin Fowler称之为“迅速而又从容不迫”[Beck,TDD]，而Ward Cunningham则解释说，这种说法主要指的是持续分析和设计，与测试关系不大。
#### 测试驱动开发&持续重构的好处
- 保持较低的缺陷数量
- 大胆地进行重构
- 得到更简单、更优秀的代码
- 编程时没有压力
#### 相关书籍
- Test-Driven Development[Beck,TDD]
- Test-Driven Development:A Practical Guide[Astels]
- 《重构》



## 5. 重构与模式
#### 模式导向的重构
> “模式导向的重构”的动机和“实现低层次重构”的一般动机是一样的：减少或去除重复的地方，简化复杂之处，使代码更好地表达其意图。
#### 案例
- Template Method（模板方法）的意图
    - 定义一个操作中算法的骨架，而将一些步骤延迟到子类中。
    - 使得子类可以在不改变算法结构的情况下，重定义该算法的某些特定步骤。 
- State（状态）的意图
    - 允许一个对象在其内部状态改变时改变自己的行为。对象看起来似乎修改了自己的类。[DP,315]
#### 总结
- 如果程序员学习了一个设计模式的所有部分，尤其是“适用性”部分，他们将了解到该模式所要解决的问题是什么。
- 因为模式之所以存在，就是为了解决问题，所以要了解在某种情况下模式是否真的有所帮助，必须理解它们有助于解决什么问题。
- 模式和重构之间存在着天然联系。模式是你想到达的目的地，而重构则是从其他地方抵达这个目的地的条条道路。[F,107]



## 6. 演进式设计
> 1. 如果想成为一名更优秀的软件设计师，了解优秀软件设计的演变过程比学习优秀设计本身更有价值，因为设计的演变过程中隐藏着真正的大智慧。演变所得到的设计结构当然也有帮助，但是不知道设计是怎么发展而来的，在下一个项目中你就很可能错误地应用，或者陷入过度设计的误区。
> 2. 如果想发挥模式的最大效用，也必须这样做：将模式放到重构的背景中领会，而不是仅仅将模式视为与重构无关的可复用的要素。这恐怕就是我编写“模式导向的重构”目录的主要原因。
> 3. 测试驱动开发和持续重构是演进式设计的关键实践。将“模式导向的重构”的概念注入如何重构的知识中，你会发现自己如有神助，能够不断地改进并得到优秀的设计。