import {useState} from "react";

export function PrintFeat({Feat}) {
	let totalManDays = (Feat?.Issues || [0]).map(({ManDays}) => ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h4>Feature: {Feat.Feat} ({totalManDays} Man-Days)</h4>
			{Feat.Issues.map(Issue => <PrintIssue Issue={merge(Feat, Issue)}></PrintIssue>)}
			<br></br>
		</div>
	)
}

export function PrintIssue({Issue: {Issue, ManDays, Proj, Feat, Mod}}) {
	return (
		<div>
			<li>[{ManDays}D][{Proj}][{Mod}][{Feat}]{Issue}</li>
		</div>
	)
}

export function PrintMod({Mod}) {
	let totalManDays = Mod.Feats.flatMap(Feat => Feat.Issues).map(Issue => Issue.ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h2>Module: {Mod.Mod} ({totalManDays} Man-Days)</h2>
			{Mod.Feats.map(Feat => <PrintFeat Feat={merge(Mod, Feat)}></PrintFeat>)}
			<hr></hr>
		</div>
	)
}

export function PrintProject({Project}) {
	let totalManDays = Project.Mods.flatMap(Mod => Mod.Feats).flatMap(Feat => Feat.Issues).map(Issue => Issue.ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h1>Project: {Project.Proj} ({totalManDays} Man-Days)</h1>
			{Project.Mods.map(Mod => <PrintMod Mod={merge(Project, Mod)}></PrintMod>)}
		</div>
	);
}

export function merge(a, b) {
	let c = {
		Proj: "",
		Mods: [],
		Mod: "",
		Feats: [],
		Feat: "",
		Issues: [],
		Issue: "",
		ManDays: 0
	}
	c.Proj = b?.Proj || a?.Proj // override
	c.Mods = b?.Mods || a?.Mods // override
	c.Mod = b?.Mod || a?.Mod // override
	c.Feats = b?.Feats || a?.Feats // override
	c.Feat = b?.Feat || a?.Feat // override
	c.Issues = b?.Issues || a?.Issues // override
	c.Issue = b?.Issue || a?.Issue // override
	c.ManDays = b?.ManDays || a?.ManDays // override
	return c
}


export function App() {
	const [inputValue, setInputValue] = useState('');
	const [project, setProject] = useState(null)
	const handleInputChange = (event) => {
		setInputValue(event.target.value);
	};
	return (
		<div>
			<h1>Time Estimate Tools</h1>
			<div>
				<input style={{
					display: 'inline-block',
					left: 0,
					width: '100%',
					height: '400px'
				}} value={inputValue} onChange={handleInputChange}
					   placeholder="Write Your Time Estimate"></input>
			</div>
			<button onClick={function (e) {
				try {
					setProject(JSON.parse(inputValue))
				} catch (e) {
					alert("invalid json")
				}
			}}>Submit Your Time Estimate
			</button>
			{(project != null) ? <PrintProject Project={project}></PrintProject> : <h1>Empty Time Estimate</h1>}
		</div>
	)
}

<App></App>