# Estimate Time Tools

import {useState} from "react";

export function PrintFeat({Feat}) {
	let totalManDays = (Feat?.Issues || [0]).map(({ManDays}) => ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h4>Feature: {Feat.Feat} ({totalManDays} Man-Days)</h4>
			{Feat.Issues.map(Issue => <PrintIssue Issue={Issue}></PrintIssue>)}
			<br></br>
		</div>
	)
}

export function PrintIssue({Issue: {Issue, ManDays, Proj, Feat, Mod}}) {
	return (
		<div>
			<li>[{ManDays}D][{Proj}][{Mod}][{Feat}]{Issue}</li>
		</div>
	)
}

export function PrintMod({Mod}) {
	let totalManDays = Mod.Feats.flatMap(Feat => Feat.Issues).map(Issue => Issue.ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h2>Module: {Mod.Mod} ({totalManDays} Man-Days)</h2>
			{Mod.Feats.map(Feat => <PrintFeat Feat={Feat}></PrintFeat>)}
			<hr></hr>
		</div>
	)
}

export function PrintProject({Project}) {
	let totalManDays = Project.Mods.flatMap(Mod => Mod.Feats).flatMap(Feat => Feat.Issues).map(Issue => Issue.ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h1>Project: {Project.Proj} ({totalManDays} Man-Days)</h1>
			{Project.Mods.map(Mod => <PrintMod Mod={Mod}></PrintMod>)}
		</div>
	);
}

export function extend(parent, child) {
	child.Proj = child?.Proj || parent?.Proj || ""
	child.Mods = child?.Mods || parent?.Mods || []
	child.Mod = child?.Mod || parent?.Mod || ""
	child.Feats = child?.Feats || parent?.Feats || []
	child.Feat = child?.Feat || parent?.Feat || ""
	child.Issues = child?.Issues || parent?.Issues || []
	child.Issue = child?.Issue || parent?.Issue || ""
	child.ManDays = child?.ManDays || parent?.ManDays || 0
}

export function fill(Project) {
	for (let Mod of Project.Mods) {
		extend(Project, Mod)
		for (let Feat of Mod.Feats) {
			extend(Mod, Feat)
			for (let Issue of Feat.Issues) {
				extend(Feat, Issue)
			}
		}
	}
	return Project
}


export function App() {
	const example = require('./example.json')
	const [inputValue, setInputValue] = useState(JSON.stringify(example));
	const [project, setProject] = useState(null)
	const handleInputChange = (event) => {
		setInputValue(event.target.value);
	};
	return (
		<div>
			<div>
				<input style={{
					display: 'inline-block',
					left: 0,
					width: '100%',
					height: '400px'
				}} value={inputValue} onChange={handleInputChange}
					   placeholder="Write Your Time Estimate"></input>
			</div>
			<button onClick={function (e) {
				try {
					setProject(JSON.parse(inputValue))
				} catch (e) {
					alert("invalid json")
				}
			}}>Submit Your Time Estimate
			</button>
			{(project != null) ? <PrintProject Project={fill(project)}></PrintProject> : <h1>Empty Time Estimate</h1>}
		</div>
	)
}

<App></App>