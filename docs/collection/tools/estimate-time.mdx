import {useState} from "react";




export const Project = {
	Proj : "sirius",
	Mods: [
		{
			Mod: "job",
			Feats: [
				{
					Feat: "node-selection",
					Issues: [
						{
							Issue: "[node][api]列表接口定义",
							ManDays: 0.5,
						},
						{
							Issue: "[node][api]列表接口实现",
							ManDays: 0.5
						},
						{
							Issue: "[api]新建接口参数定义增加节点参数定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]新建接口实现增加节点可选项",
							ManDays: 0.5
						},
						{
							Issue: "[api]新建接口增加node-spec参数定义",
							ManDays: 0.5
						},
						{
							Issue: "[state-transition]实现创建任务关联pod时携带节点参数",
							ManDays: 0.5
						},
						{
							Issue: "[resource-allocation][state-transaction]支持带节点的pod资源分配",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "logs",
					Issues: [
						{
							Issue: "[job][api]日志接口定义",
							ManDays: 0.5
						},
						{
							Issue: "[job][api]日志接口实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "resource-usage",
					Issues: [
						{
							Issue: "[job][api]实时的任务资源使用率API定义",
							ManDays: 0.5
						},
						{
							Issue: "[job][api]实时的任务资源使用率API实现",
							ManDays: 0.5
						}
					]
				}
			]
		},
		{
			Mod: "node",
			Feats: [
				{
					Feat: "create",
					Issues: [
						{
							Issue: "[api]新增接口参数定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]新新增接口实现",
							ManDays: 0.5
						},
						{
							Issue: "[state-transition]pending->active(更新节点的配置信息)",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "evict",
					Issues: [
						{
							Issue: "[api]evict节点api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]evict节点api实现",
							ManDays: 0.5
						},
						{
							Issue: "[state-transition]evicting->evicted",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "list",
					Issues: [
						{
							Issue: "[api]节点列表api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]节点列表api实现",
							ManDays: 0.5
						}
					]
				}
			]
		},
		{
			Mod: "quota",
			Feats: [
				{
					Feat: "create",
					Issues: [
						{
							Issue: "[quota][api]新增配额api定义",
							ManDays: 0.5
						},
						{
							Issue: "[quota][api]新增配额api实现",
							ManDays: 0.5
						},
						{
							Issue: "[sirius][quota][state-transaction]active过程中检查配额是否超限",
							ManDays: 1
						}
					]
				},
				{
					Feat: "update",
					Issues: [
						{
							Issue: "[quota][api]修改配额api定义",
							ManDays: 0.5
						},
						{
							Issue: "[quota][api]修改配额api实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "list",
					Issues: [
						{
							Issue: "[quota][api]配额列表api定义",
							ManDays: 0.5
						},
						{
							Issue: "[quota][api]配额列表api实现",
							ManDays: 0.5
						}
					]
				}
			]
		},
		{
			Mod: "user",
			Feats: [
				{
					Feat: "create",
					Issues: [
						{
							Issue: "[api]新增用户api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]新增用户api实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "update",
					Issues: [
						{
							Issue: "[api]修改用户api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]修改用户api实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "delete",
					Issues: [
						{
							Issue: "[api]删除用户api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]删除用户api实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "list",
					Issues: [
						{
							Issue: "[api]用户列表api定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]用户列表api实现",
							ManDays: 0.5
						}
					]
				}
			]
		},
		{
			Mod: "daemon-set(内部)",
			Feats: [
				{
					Feat: "create",
					Issues: [
						{
							Issue: "[api]新建定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]新建实现",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "state-transition",
					Issues: [
						{
							Issue: "pending->running",
							ManDays: 0.5
						},
						{
							Issue: "running状态下检查daemon-set的pod是否存在",
							ManDays: 0.5
						},
						{
							Issue: "terminating->terminated",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "terminate",
					Issues: [
						{
							Issue: "[api]终止定义",
							ManDays: 0.5
						},
						{
							Issue: "[api]终止实现",
							ManDays: 0.5
						},
						{
							Issue: "[pod][api]创建接口支持将容器原始port映射到宿主机",
							ManDays: 0.5
						},
						{
							Issue: "[pod][api]创建接口支持将容器原始port映射到宿主机的实现",
							ManDays: 0.5
						}
					]
				}
			]
		},
		{
			Mod: "cli",
			Feats: [
				{
					Feat: "base",
					Issues: [
						{
							Issue: "login",
							ManDays: 0.5
						},
						{
							Issue: "logout",
							ManDays: 0.5
						},
						{
							Issue: "命令执行前检查是否登录",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "job",
					Issues: [
						{
							Issue: "create",
							ManDays: 0.5
						},
						{
							Issue: "stop",
							ManDays: 0.5
						},
						{
							Issue: "start",
							ManDays: 0.5
						},
						{
							Issue: "terminate",
							ManDays: 0.5
						},
						{
							Issue: "create-image",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						},
						{
							Issue: "detail",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "node",
					Issues: [
						{
							Issue: "include",
							ManDays: 0.5
						},
						{
							Issue: "evict",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						},
						{
							Issue: "detail",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "pod",
					Issues: [
						{
							Issue: "create",
							ManDays: 0.5
						},
						{
							Issue: "exec",
							ManDays: 0.5
						},
						{
							Issue: "logs",
							ManDays: 0.5
						},
						{
							Issue: "evict",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						},
						{
							Issue: "detail",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "quota",
					Issues: [
						{
							Issue: "create",
							ManDays: 0.5
						},
						{
							Issue: "update",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						},
						{
							Issue: "detail",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "user",
					Issues: [
						{
							Issue: "create",
							ManDays: 0.5
						},
						{
							Issue: "update",
							ManDays: 0.5
						},
						{
							Issue: "delete",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						}
					]
				},
				{
					Feat: "daemon-set",
					Issues: [
						{
							Issue: "create",
							ManDays: 0.5
						},
						{
							Issue: "terminate",
							ManDays: 0.5
						},
						{
							Issue: "list",
							ManDays: 0.5
						},
						{
							Issue: "detail",
							ManDays: 0.5
						}
					]
				}
			]
		}
	],
}

export function PrintFeat({Feat}) {
	let totalManDays = (Feat?.Issues || [0]).map(({ManDays}) => ManDays).reduce((x, y) => x + y)
	return (
		<div>
			<h4>Feature: {Feat.Feat} ({totalManDays} Man-Days)</h4>
			{Feat.Issues.map(Issue => <PrintIssue Issue={merge(Feat, Issue)}></PrintIssue>)}
			<br></br>
		</div>
	)
}

export function PrintIssue({Issue: {Issue, ManDays, Proj, Feat, Mod}}) {
	return (
		<div>
			<li>[{ManDays}D][{Proj}][{Mod}][{Feat}]{Issue}</li>
		</div>
	)
}

export function PrintMod({Mod}) {
	return (
		<div>
			<h2>Module: {Mod.Mod}</h2>
			{Mod.Feats.map(Feat => <PrintFeat Feat={merge(Mod, Feat)}></PrintFeat>)}
			<hr></hr>
		</div>
	)
}

export function PrintProject({Project}) {
	return (
		<div>
			<h1>Project: {Project.Proj}</h1>
			{Project.Mods.map(Mod => <PrintMod Mod={merge(Project, Mod)}></PrintMod>)}
		</div>
	);
}

export function merge(a, b) {
	let c = {
		Proj: "",
		Mods: [],
		Mod: "",
		Feats: [],
		Feat: "",
		Issues: [],
		Issue: "",
		ManDays: 0
	}
	c.Proj = b?.Proj || a?.Proj // override
	c.Mods = b?.Mods || a?.Mods // override
	c.Mod = b?.Mod || a?.Mod // override
	c.Feats = b?.Feats || a?.Feats // override
	c.Feat = b?.Feat || a?.Feat // override
	c.Issues = b?.Issues || a?.Issues // override
	c.Issue = b?.Issue || a?.Issue // override
	c.ManDays = b?.ManDays || a?.ManDays // override
	return c
}


export function App() {
	const [inputValue, setInputValue] = useState('');
	const [project, setProject] = useState(null)
	const handleChange = (event) => {
		setInputValue(event.target.value);
	};
	return (
		<div>
			<h1>Time Estimate Tools</h1>
			<input value={inputValue} onChange={handleChange} placeholder="Write Your json"></input>
			<button onClick={e => setProject(JSON.parse(inputValue))}>submit
			</button>
			{(project != null) ? <PrintProject Project={project}></PrintProject> : <div>loading...</div>}
		</div>
	)
}

<App></App>